define(["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory"],function(a,b,c,d,e,f){function g(a,d,f){var g=a.getBody(),h=a.getFooter(),i=h.find('[data-action="refresh"]'),j=i.width(),k=h.find(".loading-icon");i.hide(),k.css({marginLeft:j/2+"px",marginRight:j/2+"px"}),k.show();var l=b.call([{methodname:"assignfeedback_structured_get_criteriasets",args:{contextid:d,includepublic:!f}}]);l[0].done(function(a){var b={contextId:d,manage:f,ownedSets:a.ownedSets,publicSets:a.publicSets};e.render("assignfeedback_structured/criteriasetsmanage",b).done(function(a,b){e.replaceNodeContents(g,a,b),k.hide(),i.show()}).fail(c.exception)}).fail(c.exception)}var h={init:function(b,h,i,j){if(d.get_strings([{key:"criteriasetssaved",component:"assignfeedback_structured"},{key:"criteriasetsmanage",component:"assignfeedback_structured"}]).done(function(d){var k={contextId:b,manage:h,ownedSets:i,publicSets:j},l=d[0],m=a("#id_assignfeedback_structured_critset");h&&(l=d[1],m=a("#id_assignfeedback_structured_critsetsmanage")),e.render("assignfeedback_structured/criteriasetsmanage_footer",[]).done(function(a){f.create({title:l,body:e.render("assignfeedback_structured/criteriasetsmanage",k),footer:a,large:!1},m).done(function(a){var c=a.getFooter().find('[data-action="refresh"]');c.on("click",function(){g(a,b,h)})})}).fail(c.exception)}),!h){var k=a("#id_assignfeedback_structured_critset");e.render("core/loading",[]).done(function(a,b){e.appendNodeContents(k.parent(),a,b),k.siblings(".loading-icon").hide()}).fail(c.exception)}}};return h});