define(["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){function h(a,d,f){var g=a.getBody(),h=a.getFooter(),i=h.find('[data-action="refresh"]'),j=i.width(),k=h.find(".loading-icon");i.hide(),k.css({marginLeft:j/2+"px",marginRight:j/2+"px"}),k.show();var l=b.call([{methodname:"assignfeedback_structured_get_criteriasets",args:{contextid:d,includepublic:!f}}]);l[0].done(function(a){var b={contextId:d,manage:f,ownedSets:a.ownedSets,publicSets:a.publicSets};e.render("assignfeedback_structured/criteriasets",b).done(function(a,b){e.replaceNodeContents(g,a,b),k.hide(),i.show()}).fail(c.exception)}).fail(c.exception)}var i={init:function(b,i,j,k){if(d.get_strings([{key:"criteriasetssaved",component:"assignfeedback_structured"},{key:"criteriasetsmanage",component:"assignfeedback_structured"}]).done(function(d){var l={contextId:b,manage:i,ownedSets:j,publicSets:k},m={manage:i},n=d[0],o=a("#id_assignfeedback_structured_critset");i&&(n=d[1],o=a("#id_assignfeedback_structured_critsetsmanage")),e.render("assignfeedback_structured/criteriasets_footer",m).done(function(a){f.create({title:n,body:e.render("assignfeedback_structured/criteriasets",l),footer:a,large:!1},o).done(function(a){if(i){var c=a.getFooter().find('[data-action="refresh"]');c.on("click",function(){h(a,b,i)})}else a.getRoot().on(g.shown,function(){h(a,b,i)})}).fail(c.exception)}).fail(c.exception)}),!i){var l=a("#id_assignfeedback_structured_critset");e.render("core/loading",{}).done(function(a,b){e.appendNodeContents(l.parent(),a,b),l.siblings(".loading-icon").hide()}).fail(c.exception)}}};return i});