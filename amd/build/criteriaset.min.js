define(["jquery","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g,h={init:function(h,i,j,k){var l="";c.get_string("criteriaset","assignfeedback_structured").then(function(c){l=c;var m={contextId:h,postUrl:i,ownedSets:j,publicSets:k},n=d.render("assignfeedback_structured/criteriaset",m),o=d.render("assignfeedback_structured/criteriaset_footer",[]);if(g)g.setBody(n),g.setFooter(o),g.show();else{var p=a("#id_assignfeedback_structured_critset");e.create({title:l,body:n,footer:o,large:!1},p).done(function(a){g=a,p.click(function(){g.show()}),a.getRoot().on(f.hidden,function(){b.fetchNotifications()})})}})}};return window.processCriteriaConfigData=function(b){g&&g.hide();var c=function(){a.each(b,function(b,c){a.each(c,function(c,d){var e="#id_"+c+"_"+b;a(e).val(d)})})},e=parseInt(a('[name="assignfeedback_structured_repeats"]').val(),10);if(b.length>e){for(var f=[],h=e;h<b.length;h++){var i=a('[name="assignfeedback_structured_critid['+(h-1)+']"]'),j="assignfeedback_structured_critid["+h+"]";i.clone().attr({name:j,value:"0"}).insertAfter(i),f.push({nodeIndex:h,critIndex:h+1})}var k,l,m={lastNodeIndex:e-1,lastCritIndex:e,newIndexes:f},n="id_assignfeedback_structured_critdesc_"+(e-1);a("#fitem_"+n).length?(k=a("#fitem_"+n),l="assignfeedback_structured/criterianodes"):(k=a("#"+n).parent().parent(),l="assignfeedback_structured/criterianodes_boost"),d.render(l,m).done(function(a,b){d.replaceNode(k,a,b),c()}),a('[name="assignfeedback_structured_repeats"]').val(b.length)}else{for(var h=0;h<e;h++)a("#id_assignfeedback_structured_critname_"+h).val(""),a("#id_assignfeedback_structured_critdesc_"+h).val("");c(),a("#id_assignfeedback_structured_critfieldsadd").prop("disabled",!0)}b.length>=e&&a("#id_assignfeedback_structured_critfieldsadd").prop("disabled",!1),a("#id_assignfeedback_structured_saveset").prop("disabled",!1)},h});