define(["jquery","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g,h={init:function(h,i,j,k){var l="";c.get_string("criteriaset","assignfeedback_structured").then(function(c){l=c;var m={contextId:h,postUrl:i,ownedSets:j,publicSets:k},n=d.render("assignfeedback_structured/criteriaset",m),o=d.render("assignfeedback_structured/criteriaset_footer",[]);if(g)g.setBody(n),g.setFooter(o),g.show();else{var p=a("#id_assignfeedback_structured_critset");e.create({title:l,body:n,footer:o,large:!1},p).done(function(a){g=a,p.click(function(){g.show()}),a.getRoot().on(f.hidden,function(){b.fetchNotifications()})})}})}};return window.processCriteriaConfigData=function(b){g&&g.hide();var c=function(){a.each(b,function(b,c){a.each(c,function(c,d){var e="#id_"+c+"_"+b;a(e).val(d)})})},e=a('[name="assignfeedback_structured_repeats"]'),f=parseInt(e.val(),10);if(b.length>f){for(var h=[],i=f;i<b.length;i++){var j=a('[name="assignfeedback_structured_critid['+(i-1)+']"]'),k="assignfeedback_structured_critid["+i+"]";j.clone().attr({name:k,value:"0"}).insertAfter(j),h.push({nodeIndex:i,critIndex:i+1})}var l={lastNodeIndex:f-1,lastCritIndex:f,newIndexes:h},m="id_assignfeedback_structured_critdesc_"+(f-1),n=a("#fitem_"+m),o="assignfeedback_structured/criterianodes";n.length||(n=a("#"+m).parent().parent(),o="assignfeedback_structured/criterianodes_boost"),d.render(o,l).done(function(a,b){d.replaceNode(n,a,b),c()}),e.val(b.length)}else{for(var p=0;p<f;p++)a("#id_assignfeedback_structured_critname_"+p).val(""),a("#id_assignfeedback_structured_critdesc_"+p).val("");c(),a("#id_assignfeedback_structured_critfieldsadd").prop("disabled",!0)}b.length>=f&&a("#id_assignfeedback_structured_critfieldsadd").prop("disabled",!1),a("#id_assignfeedback_structured_saveset").prop("disabled",!1)},h});