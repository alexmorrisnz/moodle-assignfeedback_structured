{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template assignfeedback_structured/criteriaset

    Provides a template for the structured feedback plugin's criteria set selector modal.

    Classes required for JS:
    * none

    Data attributes required for JS:
    * none

    Context variables required for this template:
    * contextId The context ID of the current assignment instance.
    * postUrl The URL to post the selected criteria set data to.
    * ownedSets An array of data objects for all saved criteria sets owned by the current user.
    * publicSets An array of data objects for any other available criteria sets.

    Example context (json):
    {
        "contextId": "1",
        "postUrl": "/",
        "ownedSets": [
            {
                "id": "1",
                "name": "Criteria set 1"
            },
            {
                "id": "2",
                "name": "Criteria set 2"
            }
        ],
        "publicSets": [
            {
                "id": "3",
                "name": "Criteria set 3"
            },
            {
                "id": "4",
                "name": "Criteria set 4"
            }
        ]
    }

}}
<div id="criteriaset-container" class="criteriaset-container">
    <div class="criteriaset-page">
        <form target="criteria-data-iframe" action="{{postUrl}}" id="criteriaset-selection-form" method="post">
            <select id="criteriaset-select-menu" name="criteriaset">
                <option disabled="disabled" selected>{{#str}} criteriasetselect, assignfeedback_structured {{/str}}</option>
                <optgroup label="{{#str}} criteriasetsowned, assignfeedback_structured {{/str}}">
                    {{#ownedSets}}
                        <option value="{{id}}">{{name}}</option>
                    {{/ownedSets}}
                    {{^ownedSets}}
                        <option disabled="disabled">{{#str}} noownedsets, assignfeedback_structured {{/str}}</option>
                    {{/ownedSets}}
                </optgroup>
                <optgroup label="{{#str}} criteriasetspublic, assignfeedback_structured {{/str}}">
                    {{#publicSets}}
                        <option value="{{id}}">{{name}}</option>
                    {{/publicSets}}
                    {{^publicSets}}
                        <option disabled="disabled">{{#str}} nopublicsets, assignfeedback_structured {{/str}}</option>
                    {{/publicSets}}
                </optgroup>
            </select>
            <input type="hidden" name="context" value="{{contextId}}" />
        </form>
        <div class="criteriaset-loading-container loading-screen hidden">
            {{> core/loading }}
        </div>
        <iframe id="criteria-data-iframe" name="criteria-data-iframe" class="hidden" tabindex="0">
        </iframe>
    </div>
</div>
{{#js}}
    require(['jquery'], function($) {
        var loadingContainer = $('.criteriaset-loading-container');
        var form = $('#criteriaset-selection-form');
        var iframe = $('#criteria-data-iframe');

        // Submit form.
        $('#criteriaset-select-menu').on('change', function() {
            form.submit();
            loadingContainer.removeClass('hidden');
            iframe.addClass('hidden');
        });

        iframe.on('load', function() {
            loadingContainer.addClass('hidden');
            iframe.removeClass('hidden');
            iframe.css({border: 'none', marginTop: '20px'});

            // Adjust iframe's width to the fit the container's width.
            var containerWidth = $('div.criteriaset-container').width();
            iframe.width(containerWidth + 'px');
        });
    });
{{/js}}
